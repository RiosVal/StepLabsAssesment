{{ 'science-stats.css' | asset_url | stylesheet_tag }}

<section id="section-{{ section.id }}" class="science-stats">
  <div class="science-stats__inner">
    <!-- Imagen -->
    <div class="science-stats__media">
      {% if section.settings.image != blank %}
        <img
          src="{{ section.settings.image | image_url: width: 800 }}"
          alt="{{ section.settings.image_alt | escape }}"
          loading="lazy"
          width="800"
          height="800"
        />
      {% endif %}
    </div>

    <!-- Contenido -->
    <div class="science-stats__content">
      {% if section.settings.title != blank %}
        <h2 class="science-stats__title">{{ section.settings.title }}</h2>
      {% endif %}

      {% if section.settings.intro != blank %}
        <div class="science-stats__intro">{{ section.settings.intro }}</div>
      {% endif %}

      <!-- Grupos -->
      {% for block in section.blocks %}
        {% if block.type == 'stat_group' %}
          <div class="science-stats__group">
            <h3 class="science-stats__group-title">{{ block.settings.group_title }}</h3>
            <div class="science-stats__grid">
              {% for stat in section.blocks %}
                {% if stat.type == 'stat' and stat.settings.group_id == block.id %}
                  <div class="science-stat-card">
                    {% if stat.settings.stat_heading != blank %}
                      <div class="science-stat-card__heading">{{ stat.settings.stat_heading }}</div>
                    {% endif %}
                    <div class="science-stat-card__value">{{ stat.settings.stat_value }}</div>
                    <div class="science-stat-card__label">{{ stat.settings.stat_label }}</div>
                    {% if stat.settings.stat_description != blank %}
                      <div class="science-stat-card__desc">{{ stat.settings.stat_description }}</div>
                    {% endif %}
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        {% endif %}
      {% endfor %}

      <!-- CTA -->
      {% for block in section.blocks %}
        {% if block.type == 'cta_button' %}
          <div class="science-stats__cta">
            <a href="{{ block.settings.button_link }}" class="science-stats__see {{ block.settings.button_style }}">
              {{ block.settings.button_label }} →
            </a>
          </div>
        {% endif %}
      {% endfor %}

      <!-- Referencias -->
      {% for block in section.blocks %}
        {% if block.type == 'references' %}
          <div class="science-stats__references">
            {{ block.settings.references_text | newline_to_br }}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Science / Stats",
  "settings": [
    { "type": "text", "id": "title", "label": "Título", "default": "Backed by Science. Proven by Results." },
    { "type": "textarea", "id": "intro", "label": "Intro / subtítulo" },
    { "type": "image_picker", "id": "image", "label": "Imagen a la izquierda" },
    { "type": "text", "id": "image_alt", "label": "Alt de la imagen" }
  ],
  "blocks": [
    {
      "type": "stat_group",
      "name": "Grupo de estadísticas",
      "settings": [
        { "type": "text", "id": "group_title", "label": "Título del grupo" }
      ]
    },
    {
      "type": "stat",
      "name": "Estadística",
      "settings": [
        { "type": "text", "id": "group_id", "label": "Asignar al grupo (id del bloque padre)" },
        { "type": "text", "id": "stat_heading", "label": "Texto superior (ej. In a clinical study¹)" },
        { "type": "text", "id": "stat_value", "label": "Valor (ej. 2.0x)" },
        { "type": "text", "id": "stat_label", "label": "Etiqueta breve" },
        { "type": "textarea", "id": "stat_description", "label": "Descripción corta (opcional)" }
      ]
    },
    {
      "type": "cta_button",
      "name": "Botón CTA",
      "settings": [
        { "type": "text", "id": "button_label", "label": "Texto del botón", "default": "See The Science" },
        { "type": "url", "id": "button_link", "label": "Enlace del botón" },
        { "type": "select", "id": "button_style", "label": "Estilo",
          "options": [
            { "value": "primary", "label": "Primario" },
            { "value": "outline", "label": "Contorno" }
          ],
          "default": "primary"
        }
      ]
    },
    {
      "type": "references",
      "name": "Referencias",
      "settings": [
        { "type": "textarea", "id": "references_text", "label": "Texto de las referencias" }
      ]
    }
  ],
  "presets": [ { "name": "Science / Stats", "category": "Custom" } ]
}
{% endschema %}